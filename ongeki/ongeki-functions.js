const ongeki_chart_list={lev_bas:"BASIC",lev_adv:"ADVANCED",lev_exc:"EXPERT",lev_mas:"MASTER",lev_lnt:"LUNATIC"};var columns_params=[{displayTitle:"ID (system)",name:"id",data:"id",className:"id detail-hidden",visible:!1,searchable:!1},{displayTitle:"#",name:"index",data:"id",className:"id detail-hidden",data:function(a){return a.id},render:renderInWrapper(),width:"20px",searchable:!1,visible:!1},{displayTitle:"アルバムアート",name:"jacket",data:"image_url",className:"jacket detail-hidden",render:function(a){return'<span class="img-wrap"><img src="jacket/'+a+'"/></span>'},width:"50px",orderable:!1,searchable:!1},{displayTitle:"曲名",name:"title",data:"title",className:"title-artist detail-hidden",render:function(a,e,l){return"display"===e?'<div class="inner-wrap">'+("1"==l.bonus?'<span class="bonus">BONUS</span>':"")+'<span class="title">'+a+'</span><span class="dash hidden"> - </span><span class="artist-display hidden">'+l.artist+"</span></div>":"filter"===e?a:l.title_sort},width:"80vw"},{displayTitle:"曲名 (読み)",name:"title_sort",data:"title_sort",className:"title-sort",visible:!1,searchable:!1},{displayTitle:getTranslation(userLanguage,"col_artist"),name:"title_merged",data:"title",className:"artist detail-hidden",render:function(a,e,l){return"display"===e?'<div class="inner-wrap"><span class="artist-display hidden">'+l.artist+"</span></div>":l.title_sort}},{displayTitle:getTranslation(userLanguage,"col_artist"),name:"artist",data:"artist",className:"artist detail-hidden",visible:!1},{displayTitle:"BPM",name:"bpm",data:"bpm",className:"details bpm",searchable:!1,visible:!1},{displayTitle:getTranslation(userLanguage,"col_version"),name:"version",data:"version",className:"details version",filterable:!0,render:renderInWrapper(),customDropdownSortSource:"date",width:"12em"},{displayTitle:getTranslation(userLanguage,"col_genre"),name:"category",data:"category",className:"details category",render:renderInWrapper(),customDropdownSortSource:"category_id",filterable:!0},{displayTitle:"ジャンルID",name:"category_id",data:"category_id",width:"90px",visible:!1,searchable:!1},{displayTitle:"チャプターID",name:"chap_id",data:"chap_id",className:"chapter-id",visible:!1,searchable:!1},{displayTitle:getTranslation(userLanguage,"col_chapter"),name:"chap",data:function(a,e,l,s){return"sort"===e||"meta"===e?a.chap_id:parseChapId(a,!0)+a.chapter},className:"chapter",width:"15em",render:function(a,e,l){return"display"===e?`<div class="inner-wrap"><span class="chap-id-badge">${parseChapId(l,!0)}</span><span class="chap-name">${l.chapter}</span></div>`:a},filterable:!0,visible:!1},{displayTitle:getTranslation(userLanguage,"col_enemy_type"),name:"enemy_type",data:"enemy_type",className:"chara type",render:function(a,e,l){return"display"===e?`<div class="inner-wrap"><span class="element-type-icon ${a.toLowerCase()}"><span class="icon"></span><span class="label-text">${a}</span></span></div>`:a},width:"40px",filterable:!0},{displayTitle:"キャラID",name:"chara_id",data:"chara_id",visible:!1,searchable:!1},{displayTitle:getTranslation(userLanguage,"col_chara"),name:"character",data:"character",className:"chara character",render:function(a,e,l){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},customDropdownSortSource:"chara_id",width:"10em",filterable:!0},{displayTitle:getTranslation(userLanguage,"col_enemy_lv"),name:"enemy_lv",data:"enemy_lv",className:"chara enemy-lv",render:function(a,e,l){return"display"===e?`<div class="inner-wrap">Lv.${a}</div>`:a},customDropdownSortSource:sortByLeadingZeros("enemy_lv"),width:"4em",searchable:!1},{displayTitle:"BASIC",name:"lev_bas",data:sortLevels("lev_bas"),className:"lv lv-bsc",render:renderLvNum("lev_bas"),customDropdownSortSource:sortByLeadingZeros("lev_bas"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"ADVANCED",name:"lev_adv",data:sortLevels("lev_adv"),className:"lv lv-adv",render:renderLvNum("lev_adv"),customDropdownSortSource:sortByLeadingZeros("lev_adv"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"EXPERT",name:"lev_exc",data:sortLevels("lev_exc"),className:"lv lv-exp",render:renderLvNum("lev_exc"),customDropdownSortSource:sortByLeadingZeros("lev_exc"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"MASTER",name:"lev_mas",data:sortLevels("lev_mas"),className:"lv lv-mas",render:renderLvNum("lev_mas"),customDropdownSortSource:sortByLeadingZeros("lev_mas"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"LUNATIC",name:"lev_lnt",data:sortLevels("lev_lnt"),className:"lv lv-lnt",render:renderLvNum("lev_lnt"),customDropdownSortSource:sortByLeadingZeros("lev_lnt"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:getTranslation(userLanguage,"col_chart"),name:"chart_diff",data:function(a,e,l,s){return 1==flat_view?"sort"===e||"meta"===e?a.chart_diff:convertDifficultyNames(a.chart_diff,!1,ongeki_chart_list):null},className:"lv-name detail-hidden",width:"3rem",createdCell:flat_view?function(a,e,l,s,t){$(a).addClass(l.chart_diff)}:null,render:flat_view?renderChartDifficultyName("chart_diff",!1,ongeki_chart_list):null,customDropdownSortSource:flat_view?sortByDifficultyCategory("chart_diff",ongeki_chart_list):null,filterable:flat_view,visible:!1},{displayTitle:"難易度グループ",name:"chart_lev",data:flat_view?"chart_lev":null,className:"lv detail-hidden",width:"4rem",customDropdownSortSource:sortByLeadingZeros("chart_lev"),reverseSortOrder:!0,visible:!1},{displayTitle:getTranslation(userLanguage,"col_difficulty_level"),name:"chart_lev_i",data:flat_view?"chart_lev_i":null,className:"lv lv-name detail-hidden",render:flat_view?renderChartDifficultyNameAndLv("chart_diff","chart_lev","chart_lev_i","chart_lev_i_display",ongeki_chart_list):null,width:"4rem",createdCell:flat_view?function(a,e,l,s,t){$(a).addClass(l.chart_diff)}:null,searchable:!1,visible:flat_view},{displayTitle:getTranslation(userLanguage,"col_notes"),name:"chart_notes",data:flat_view?"chart_notes":null,className:"details notecount detail-hidden",width:"6em",searchable:!1,visible:!1},{displayTitle:getTranslation(userLanguage,"col_bells"),name:"chart_bells",data:flat_view?"chart_bells":null,className:"details notecount detail-hidden",width:"5em",searchable:!1,visible:!1},{displayTitle:"譜面作者",name:"chart_designer",data:flat_view?"chart_designer":null,defaultContent:"",width:"15em",className:"details detail-hidden designer",filterable:flat_view,searchable:flat_view},{displayTitle:"譜面",name:"chart_link",data:flat_view?"chart_link":null,defaultContent:"",render:flat_view?renderChartLinkBtn("chart_link","ongeki"):null,width:"5em",className:"details detail-hidden chart-link"},{displayTitle:getTranslation(userLanguage,"col_added_date"),name:"date",data:function(a,e,l,s){return formatDate(a.date)},className:"date",filterable:!0,render:function(a,e,l){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},reverseSortOrder:!0,width:"4em"},{displayTitle:"BONUS",name:"bonus",data:"bonus",className:"details detail-hidden",width:"10px",searchable:!1},{displayTitle:"NEW",name:"new",data:"new",searchable:!1,visible:!1}],default_order=flat_view?[[getColumnIndexByName("chart_lev_i"),"desc"],[getColumnIndexByName("chart_diff"),"desc"],[getColumnIndexByName("date"),"desc"]]:[[getColumnIndexByName("date"),"desc"],[getColumnIndexByName("id"),"asc"]],default_search=getDefaultSearchValues(columns_params);function processOngekiChartData(a,e){return a[e]?{...a,chart_diff:e,chart_lev:a[e],chart_lev_i:parseFloat(a[e+"_i"]||a[e].replace("+",".7")),chart_lev_i_display:a[e+"_i"]||`<span class="approx">${parseFloat(a[e].replace("+",".7")).toFixed(1)}</span>`,chart_notes:a[e+"_notes"],chart_bells:a[e+"_bells"],chart_designer:a[e+"_designer"],chart_link:a[e+"_chart_link"]}:null}function parseChapId(a,e){var l=a.chap_id,s=l.substr(3,2);if("0"==l.substr(0,1)){var t=l.substr(1,1);if("8"==l.substr(3,1)){var t=l.substr(1,1);s="S"+l.substr(4,1)}return t>"0"?t+"-"+s+(e?" ":""):""}return"70"==l.substr(0,2)?(t="M")+"-"+s+(e?" ":""):"80"==l.substr(0,2)?(t="SP2")+"-"+s+(e?" ":""):"99"==l.substr(0,2)?(t="SP")+"-"+s+(e?" ":""):l+(e?" ":"")}$(document).ready((function(){$.getJSON("data/music-ex.json",(a=>{$("#table").DataTable({data:flattenMusicData(a,flat_view,ongeki_chart_list,processOngekiChartData),buttons:[{extend:"colvis",className:"config-btn",columns:".toggle",text:getTranslation(userLanguage,"colvis_btn_label"),collectionTitle:getTranslation(userLanguage,"colvis_guide_text"),collectionLayout:"fixed",fade:150}],columns:columns_params,searchCols:default_search,drawCallback:function(a){toggleDateRowGroup(this,default_search)},deferRender:!0,dom:'<"toolbar-group"<"toolbar filters"><"toolbar search"f>><"toolbar secondary"<"info"ilB>><"table-inner"rt><"paging"p>',language:localize_strings[userLanguage],lengthMenu:[[25,50,100,-1],[25,50,100,"All"]],order:default_order,responsive:{details:{type:"column",target:"tr",display:$.fn.dataTable.Responsive.display.modal({header:renderModalHeader("オンゲキ","image_url","wikiwiki_url","https://wikiwiki.jp/gameongeki/","譜面確認"),footer:renderModalFooter("オンゲキ")}),renderer:function(a,e,l){function s(a,e){columns_params[a.columnIndex];if(!a.className.includes("detail-hidden")&&!a.className.includes("lv ")&&!a.className.includes("chara "))return`<div class="row ${a.className}" data-dt-row="${a.rowIndex}" data-dt-column="${a.columnIndex}">\n                      <span class="row-label">${a.title}</span>\n                      <span>${a.data}</span>\n                    </div>`}function t(a,e){if(a.className.includes("chara ")&&!a.className.includes("detail-hidden")){var l=columns_params[a.columnIndex];return`<div class="row ${a.className}" data-dt-row="${a.rowIndex}" data-dt-column="${a.columnIndex}">\n                    <span class="row-label">${l.displayTitle}</span>\n                    <span>${a.data}</span>\n                  </div>`}}function n(a,e){a[""+e],a[e+"_i"];return`\n                <span class="main-info-wrap">\n                  ${lvNumHtmlTemplate(a,e)}\n                </span>\n                <span class="sub-info-wrap">\n                  ${hasPropertyAndValue(a,e+"_notes")?`<span class="notes-detail-wrap">\n                      <span class="notes"><span class="label">Notes</span><span>${a[e+"_notes"]}</span></span>\n                      ${hasPropertyAndValue(a,e+"_bells")?`<span class="bells"><span class="label">Bells</span><span>${a[e+"_bells"]}</span></span>`:""}\n                    </span>`:""}\n                  ${hasPropertyAndValue(a,e+"_designer")?`<span class="designer"><span class="label">Designer</span><span>${a[e+"_designer"]}</span></span>`:""}\n                </span>\n                ${hasPropertyAndValue(a,e+"_chart_link")?`<span class="chart-link">${chartLinkBtn(a[e+"_chart_link"],"ongeki")}</span>`:""}`}function r(a,e,l){if(a.className.includes("lv ")&&!a.className.includes("detail-hidden")){var s=columns_params[a.columnIndex].name;return"lunatic"===l&&"lev_lnt"===s&&hasPropertyAndValue(e,"lev_lnt")?`<div class="row ${a.className}" data-dt-row="${a.rowIndex}" data-dt-column="${a.columnIndex}">\n                        <span class="row-label"><span class="diff-name lv-lnt">LUNATIC</span></span>\n                        <span class="content-col ${hasPropertyAndValue(e,s+"_chart_link")&&"has-chart-link"}">\n                          <span class="diff-name ${a.className}"><span>${columns_params[a.columnIndex].displayTitle}</span></span>\n                          ${n(e,s)}</span>\n                      </div>`:"lunatic"!==l?"lev_ult"===s&&!hasPropertyAndValue(e,s)||"lev_lnt"===s&&!hasPropertyAndValue(e,"lev_lnt")?void 0:`\n                    <div class="row ${a.className}" data-dt-row="${a.rowIndex}" data-dt-column="${a.columnIndex}">\n                      <span class="row-label"><span class="diff-name ${a.className}">${columns_params[a.columnIndex].displayTitle}</span></span>\n                      <span class="content-col ${hasPropertyAndValue(e,s+"_chart_link")&&"has-chart-link"}">\n                        <span class="diff-name ${a.className}"><span>${columns_params[a.columnIndex].displayTitle}</span></span>\n                        ${n(e,s)}\n                      </span>\n                    </div>`:void 0}}var i=a.row(e).data(),d=i.chara_id,c=i.enemy_type;return function(a,e,l,n){var i=l.map((a=>s(a))).join(""),o=l.map((a=>t(a))).join(""),p=l.map((e=>r(e,a))).join(""),u=l.map((e=>r(e,a,"lunatic"))).join(""),m=`<div class="table-wrapper">\n                  <div class="details-table misc-details">\n                    <div class="table-header"><span class="th-label">CHARACTER</span></div>\n                    ${o}\n                    ${"1"==d.substr(0,1)?`<span class="chara-img ${c.toLowerCase()}" style="--chara-img: url('./img/chara/${d}.png');"></span>`:""}\n                  </div>\n                  <div class="details-table-wrap">\n                    ${e?`<div class="details-table chart-details lunatic">\n                      <div class="table-header"><span class="th-label">CHART</span></div>\n                      ${u}\n                    </div>`:`<div class="details-table chart-details std">\n                      <div class="table-header"><span class="chart-type-badge std"></span><span class="th-label">CHART</span></div>\n                      ${p}\n                    </div>`}\n                  </div>\n                  <div class="details-table misc-details">\n                    <div class="table-header"><span class="th-label">SONG METADATA</span></div>\n                    ${i}\n                  </div>\n                </div>`;return m||!1}(i,i.lunatic?"lunatic":"",l)}}},rowGroup:{dataSrc:"date",startRender:flat_view||""!=searchParams?null:function(a,e){return date_display=""===e?"NEW":getTranslation(userLanguage,"date_added_with_date").replace("__date__",formatDate(e,"weekday")),`<div>${date_display}</div>`}},scrollX:!0,initComplete:function(){tableInitCompleteFunctions(this)}})}))}));

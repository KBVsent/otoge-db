const root=document.documentElement,siteMenuWrap=$("#site-menu-wrap"),siteMenuBtn=$("#site-menu-btn");let scrollPos,isMenuOpen=!1;document.addEventListener("DOMContentLoaded",(function(){function e(){const e=document.querySelector('input[name="colorScheme"]:checked').value;localStorage.setItem("userColorScheme",e),root.setAttribute("data-theme",e)}colorSchemeInput.forEach((n=>{n.addEventListener("change",e)}));const n=localStorage.getItem("userColorScheme");n||localStorage.setItem("userColorScheme","auto");const t=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.querySelector(`input[value="${t}"]`).checked=!0,e(),langOptionInput.forEach((e=>{e.addEventListener("change",setLanguage)}));const a=userLanguage||"ja";document.querySelector(`input[value="${a}"]`).checked=!0}));const getTransitionEvent=()=>{const e=document.createElement("fakeelement"),n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(const t in n)if(void 0!==e.style[t])return n[t]},transitionEvent=getTransitionEvent();function updateQueryStringParameter(e,n){var t=new URLSearchParams(window.location.search);if("URLSearchParams"in window){""===n?t.delete(e):t.set(e,n);var a=window.location.pathname+"?"+t.toString();history.pushState(null,"",a)}}function clearQueryStringParameter(){new URLSearchParams(window.location.search);if("URLSearchParams"in window){var e=window.location.pathname;history.pushState(null,"",e)}}function appendSelectboxStateClass(e,n){""!==n?e.addClass("changed"):e.removeClass("changed")}function replaceUnitText(e){let n;switch(userLanguage){case"ja":n=flat_view?"譜面":"曲";break;case"ko":n=flat_view?" 보면":" 곡";break;case"en":n=flat_view?" charts":" songs"}if(null!==e&&"object"==typeof e)for(const t in e)e.hasOwnProperty(t)&&(e[t]=replaceUnitText(e[t]),"string"==typeof e[t]&&(e[t]=e[t].replace("{unit}",n)));return e}transitionEndCallback=e=>{root.removeEventListener(transitionEvent,transitionEndCallback),root.classList.remove("transitioning")},$(document).ready((function(){function e(){dataLayer.push(arguments)}function n(){siteMenuWrap.addClass("anim-leave").one("animationend webkitAnimationEnd oAnimationEnd",(function(){siteMenuWrap.removeClass("open").removeClass("anim-leave")})),$("#app-wrapper").removeClass("menu-open").css("top",""),$(window).scrollTop(scrollPos),isMenuOpen=!1,siteMenuBtn.removeClass("active")}"URLSearchParams"in window&&updateChartLevelSelectboxValue(searchParams),$("html").removeClass("page-loading"),window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","UA-141271073-1"),e("config","G-YZ8GJR7QFL"),siteMenuBtn.on("click",(function(){event.preventDefault(),isMenuOpen?n():(siteMenuBtn.addClass("active"),scrollPos=$(window).scrollTop(),$("#app-wrapper").css("top",-1*scrollPos).addClass("menu-open"),$(window).scrollTop(0),siteMenuWrap.addClass("open").addClass("anim-enter").one("animationend webkitAnimationEnd oAnimationEnd",(function(){siteMenuWrap.removeClass("anim-enter"),isMenuOpen=!0})))})),$(document).on("keydown",(function(e){"Escape"===e.key&&isMenuOpen&&n()})),$("#site-menu-backdrop").on("click",(function(){isMenuOpen&&n()})),$("#site-menu-close-btn").on("click",(function(){isMenuOpen&&n()}))}));
var searchParams=new URLSearchParams(window.location.search);function hasPropertyAndValue(e,a){return e.hasOwnProperty(a)&&""!==e[a]}function sortLevels(e){return function(a,n,r,t){var s=e+"_i";return"sort"===n?a[s]?addLeadingZero(a[s]):addLeadingZero(a[e]):a[e]}}function addLeadingZero(e){return""!=e?(lev_processed=parseInt(e)<10?"0"+e:e,lev_processed):""}function sortByLeadingZeros(e){return function(a,n){var r=a[e]?a[e]:"",t=n[e]?n[e]:"";return addLeadingZero(r).localeCompare(addLeadingZero(t))}}function lvNumHtmlTemplate(e,a,n=!0){if(e[a]){var r=(a=""+a)+"_i",t=n&&e[r]?`<span class="lv-num-precise">${e[r]}</span>`:"",s=e[a].match(/^([0-9]{1,2})(\+?)(\?)?$/);return`<span class="lv-num-simple">${s?`<span class="num">${s[1]}</span>`:`<span class="num">${e[a]}</span>`}${s&&"+"===s[2]?'<span class="plus">+</span>':""}${s&&"?"===s[3]?'<span class="question">?</span>':""}</span>\n        ${t}`}}function renderLvNum(e){return function(a,n,r){return"display"===n&&r[e]?`\n        <div class="inner-wrap">\n          ${lvNumHtmlTemplate(r,e)}\n        </div>`:a}}function renderChartDifficultyNameAndLv(e,a,n,r,t){return function(n,s,i){if("display"===s){var o=convertDifficultyNames(i[e],!1,t);if("we_kanji"===i[e])var l="☆"+i[r];else if("lev_utage"===i[e])l="";else l=i[r];return`\n        <div class="inner-wrap">\n          <span class="diff-name">${o}</span>\n          <span class="lv-num-wrap">\n            ${lvNumHtmlTemplate(i,a,!1)}\n            <span class="lv-num-precise">${l}</span>\n          </span>\n        </div>`}return n}}function renderChartLinkBtn(e,a){return function(e,n,r){return"display"===n?chartLinkBtn(r.chart_link,a):e}}function chartLinkBtn(e,a){return e&&""!==e?`<a class="btn chartlink" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();" href="https://sdvx.in/${a}/${e}.htm">\n          <span class="img"></span><span>${getTranslation(userLanguage,"check_chart_guide")}</span>\n        </a><span class="chart-provider">${getTranslation(userLanguage,"chart_guide_provide_credit")}</span>`:""}function renderChartDifficultyName(e,a){return function(n,r,t){return"display"===r?'<span class="diff-name">'+convertDifficultyNames(t[e],!1,a)+"</span>":n}}function convertDifficultyNames(e,a,n){const r=n[e];if(a){var t=Object.keys(n).indexOf(e)+1;return e.startsWith("dx_")&&(t-=1),1===t.toString().length&&(t="0"+t),`${t} ${r}`}return r}function sortByDifficultyCategory(e,a){return function(n,r){return convertDifficultyNames(n[e],!0,a).localeCompare(convertDifficultyNames(r[e],!0,a))}}function renderInWrapper(){return function(e,a,n){return"display"===a?'<div class="inner-wrap">'+e+"</div>":e}}function flattenMusicData(e,a,n,r){return a?e.map((e=>Object.keys(n).map((a=>r(e,a))))).flat().filter((e=>!!e)):e}function formatDate(e,a){if(8===e.length)var n=e.slice(0,4),r=e.slice(4,6),t=e.slice(6,8);else{if(6!==e.length)return"?";n="20"+e.slice(0,2),r=e.slice(2,4),t=e.slice(4,6)}var s=`${n}-${r}-${t}`;if("weekday"==a)var i=getTranslation(userLanguage,"days_of_week"),o=((new Date).getFullYear()==n?"":n+"/")+`${r}/${t}(${i[new Date(s).getDay()]})`;else o=s;return o}function getColumnIndexByName(e){return columns_params.findIndex((function(a){return a.name===e}))}function tableInitCompleteFunctions(e){function a(a){if("gameRegionQuickSwitch"===a.target.id)var n=a.target.checked?"intl":"jp";else n=document.querySelector('input[name="gameRegion"]:checked').value;localStorage.setItem("userGameRegion",n),root.setAttribute("data-game-region",n);getDefaultSearchValues(columns_params,"intl"===n);var r=columns_params.findIndex((e=>void 0!==e.defaultSearch));if(-1!==r){var t="intl"===n?columns_params[r].defaultSearch:"";e.api().column(r).search(t).draw()}"gameRegionQuickSwitch"===a.target.id?(document.getElementById("gameRegionIntl").checked=a.target.checked,document.getElementById("gameRegionJP").checked=!a.target.checked):document.getElementById("gameRegionQuickSwitch").checked="intl"===n}generateFilterDropdowns(e),applyFilterFromURLSearchParams(e,searchParams),$("#table").addClass("loading-done"),$("html").removeClass("table-loading"),$("#table").on("column-visibility.dt",(function(){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()})),$("select#chart_lev").on("change",(function(){var a=$(this),n=$(this).val(),r=$.fn.dataTable.util.escapeRegex($(this).val());"filter"==a.data("type")?(e.api().column("chart_lev:name").search(r?"^"+r+"$":"",!0,!1),updateQueryStringParameter("chart_lev",n),e.api().draw()):window.location.href="./lv?chart_lev="+encodeURIComponent(n)})),$("button.reset-search").on("click",(function(){e.api().order(default_order).columns().search("");const a=columns_params.findIndex((e=>void 0!==e.defaultSearch));if(-1!==a){const n=columns_params[a].defaultSearch;e.api().column(a).search(n)}e.api().draw(),clearQueryStringParameter(),$(".toolbar.filters select").prop("selectedIndex",0).removeClass("changed")})),gameRegionChecks.forEach((e=>{e.addEventListener("change",a)})),gameRegionQuickSwitch.addEventListener("change",a)}function generateFilterDropdowns(e){var a=e.api().rows().data();e.api().columns().every((function(){var n=e.api().order(),r=this,t=r.data(),s=columns_params[r.index()];if("filterable"in s&&1==s.filterable){var i=$(`<div class="select-wrap ${s.className}"></div>`).appendTo($(".toolbar.filters")),o=$('<select id="'+s.name+'"><option value="" data-default>——</option></select>').appendTo(i);$(`<span class="label">${s.displayTitle}</span>`).appendTo(i);if(o.on("change",(function(){var e=$(this).val(),a=$.fn.dataTable.util.escapeRegex($(this).val());appendSelectboxStateClass($(this),e),r.index()===getColumnIndexByName("date")||""===a&&n[0][0]===getColumnIndexByName("date")?r.rowGroup().enable():r.rowGroup().disable(),updateQueryStringParameter(s.name,e),r.search(a?"^"+a+"$":"",!0,!1).draw()})),t=s.customDropdownSortSource?t.map((function(e,a){return a})).sort((function(e,n){var r=a[e],t=a[n];return"function"==typeof s.customDropdownSortSource?s.customDropdownSortSource(r,t):r[s.customDropdownSortSource].localeCompare(t[s.customDropdownSortSource])})).map((function(e){return t[e]})):t.sort(),s.reverseSortOrder&&t.reverse(),t.unique().each((function(e,a){""!=e&&o.append('<option value="'+e+'">'+e+"</option>")})),"URLSearchParams"in window){var l=searchParams.get(s.name);if(null!==l){var c=unescapeSlashes(l);t.unique().each((function(e){o.val(c)})),appendSelectboxStateClass(o,c)}}}})),$(`<button class="btn reset-search">\n    <svg class="symbol icon-cross" aria-hidden="true" focusable="false"><use href="/shared/img/symbols.svg#icon-cross"></use></svg>\n    ${getTranslation(userLanguage,"clear_filters")}\n    </button>`).appendTo($(".toolbar.filters"))}function applyFilterFromURLSearchParams(e,a){"URLSearchParams"in window&&(a.forEach((function(n,r){e.api().columns().every((function(){var e=columns_params[this.index()],n=a.get(e.name),r=$.fn.dataTable.util.escapeRegex(decodeURIComponent(n));null!==n&&this.search(n?"^"+r+"$":"",!0,!1)}))})),e.api().draw())}function toggleDateRowGroup(e,a){var n=e.api().order();isSearchActive(e.api().columns().search(),a)||(n[0][0]!==getColumnIndexByName("date")?e.api().rowGroup().disable():e.api().rowGroup().enable())}function isSearchActive(e,a){for(let n=0;n<e.length;n+=1)if(""!==e[n]){if(e[n]===a[n].search)continue;return!0}return!1}function getDefaultSearchValues(e,a=!1){return a?e.map((e=>void 0!==e.defaultSearch?{search:e.defaultSearch}:null)):Array(e.length).fill(null)}function renderModalHeader(e,a,n,r,t="譜面確認"){return function(s){var i=s.data(),o=encodeURIComponent(i.title.replaceAll("&","＆").replaceAll(":","：").replaceAll("[","［").replaceAll("]","］").replaceAll("#","＃").replaceAll('"',"”")),l=i[a],c=`${r}${o}`,u=i[n]?i[n]:c;return`\n      <div class="modal-header" style="--img:url(jacket/${l});">\n        <span class="header-img"></span>\n        <span class="header-img-overlay"></span>\n        <div class="img-wrap">\n          <img src="jacket/${l}" />\n        </div>\n        <div class="content-wrap">\n          <span class="title">${i.title}</span>\n          <span class="artist">${i.artist}</span>\n          <div class="quicklinks">\n            <a class="wiki" href="${u}" target="_blank" rel="noopener noreferrer nofollow">Wiki</a>\n            <a class="youtube" href="https://youtube.com/results?search_query=${e}+${t}+${o}" target="_blank" rel="noopener noreferrer nofollow"></a>\n          </div>\n        </div>\n      </div>`}}function renderModalFooter(e){return function(a){var n=a.data();return`\n      <div class="modal-footer">\n        <div class="report">\n          <a class="report-btn"\n            href="https://twitter.com/intent/tweet?text=@otoge_db%0A%E3%80%90%23${e}_DB%20%E6%83%85%E5%A0%B1%E6%8F%90%E4%BE%9B%E3%80%91%0A%E6%9B%B2%E5%90%8D%EF%BC%9A${encodeURIComponent(n.title)}%0A%E8%AD%9C%E9%9D%A2%EF%BC%9A"\n            target="_blank" rel="noopener noreferrer nofollow">${getTranslation(userLanguage,"report_twitter")}</a>\n        </div>\n      </div>`}}

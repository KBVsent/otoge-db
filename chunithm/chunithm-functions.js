$(document).ready((function(){var a,e,s,l,n=new URLSearchParams(window.location.search),t=[{displayTitle:"ID (system)",name:"id",data:"id",className:"id detail-hidden",visible:!1},{displayTitle:"#",name:"index",data:"id",className:"id detail-hidden",data:function(a){return a.id},render:function(a,e,s){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},width:"20px",searchable:!1,visible:!1},{displayTitle:"アルバムアート",name:"jacket",data:"image",className:"jacket detail-hidden",render:function(a){return'<span class="img-wrap"><img src="jacket/'+a+'"/></span>'},width:"50px",orderable:!1,searchable:!1},{displayTitle:"曲名",name:"title",data:"title",className:"song-title detail-hidden",render:function(a,e,s){return"display"===e?'<div class="inner-wrap"><span class="title">'+a+'</span><span class="dash hidden"> - </span><span class="artist-display hidden">'+s.artist+"</span></div>":"filter"===e?a:s.reading},width:"80vw"},{displayTitle:"曲名 (読み)",name:"reading",data:"reading",className:"reading",visible:!1,searchable:!1},{displayTitle:"アーティスト",name:"title_merged",data:"title",className:"artist detail-hidden",render:function(a,e,s){return"display"===e?'<div class="inner-wrap"><span class="artist-display hidden">'+s.artist+"</span></div>":s.reading},searchable:!1},{displayTitle:"アーティスト",name:"artist",data:"artist",className:"artist detail-hidden",visible:!1},{displayTitle:"BPM",name:"bpm",data:"bpm",className:"details bpm",searchable:!1,visible:!1},{displayTitle:"バージョン",name:"version",data:"version",className:"details version",filterable:!0,render:function(a,e,s){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},customDropdownSortSource:"date",width:"12em"},{displayTitle:"ジャンル",name:"category",data:"catname",className:"category",render:function(a,e,s){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},width:"12em",filterable:!0},{displayTitle:"BASIC",name:"lev_bas",data:c("lev_bas","lev_bas_i"),className:"lv lv-bsc",render:p("lev_bas","lev_bas_i"),customDropdownSortSource:o("lev_bas"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"ADVANCED",name:"lev_adv",data:c("lev_adv","lev_adv_i"),className:"lv lv-adv",render:p("lev_adv","lev_adv_i"),customDropdownSortSource:o("lev_adv"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"EXPERT",name:"lev_exp",data:c("lev_exp","lev_exp_i"),className:"lv lv-exp",render:p("lev_exp","lev_exp_i"),customDropdownSortSource:o("lev_exp"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"MASTER",name:"lev_mas",data:c("lev_mas","lev_mas_i"),className:"lv lv-mas",render:p("lev_mas","lev_mas_i"),customDropdownSortSource:o("lev_mas"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"ULTIMA",name:"lev_ult",data:c("lev_ult","lev_ult_i"),className:"lv lv-ult",render:p("lev_ult","lev_ult_i"),customDropdownSortSource:o("lev_ult"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"WORLD'S END",name:"lev_we",data:"we_kanji",className:"lv lv-we",render:(s="we_kanji",l="we_star",function(a,e,n){return"display"===e?""!==n[s]?'<div class="inner-wrap"><span class="lv-num-simple">'+n[s]+'</span><span class="lv-num-precise">☆'+v(n[l])+"</span></div>":"":a}),customDropdownSortSource:o("we_star"),reverseSortOrder:!0,width:"3rem",filterable:!flat_view},{displayTitle:"WORLD'S END☆",name:"we_star",data:v("we_star"),className:"lv lv-we we-star",reverseSortOrder:!0,width:"3rem",searchable:!1},{displayTitle:"譜面",name:"chart_diff",data:function(a,e,s,l){return 1==flat_view?"sort"===e||"meta"===e?a.chart_diff:u(a.chart_diff):null},className:"lv-name detail-hidden",width:"3rem",createdCell:flat_view?function(a,e,s,l,n){$(a).addClass(s.chart_diff)}:null,render:flat_view?(e="chart_diff",function(a,s,l){return"display"===s?'<span class="diff-name">'+u(l[e])+"</span>":a}):null,customDropdownSortSource:flat_view?(a="chart_diff",function(e,s){return u(e[a],!0).localeCompare(u(s[a],!0))}):null,filterable:flat_view,visible:!1},{displayTitle:"難易度グループ",name:"chart_lev",data:flat_view?"chart_lev":null,className:"lv detail-hidden",width:"4rem",customDropdownSortSource:o("chart_lev"),reverseSortOrder:!0,visible:!1,searchable:!1},{displayTitle:"譜面レベル",name:"chart_lev_i",data:flat_view?"chart_lev_i":null,className:"lv lv-name detail-hidden",render:flat_view?function(a,e,s,l){return function(s,n,t){if("display"===n){var r=u(t[a]),i="we_kanji"===t[a]?"☆"+t[l]:t[l],c=t[e].match(/^([0-9]{1,2})(\+)?$/);if(c){var d=c[1];return"+"===c[2]?`<div class="inner-wrap"><span class="diff-name">${r}</span><span class="lv-num-wrap"><span class="lv-num-simple"><span class="num">${d}</span><span class="plus">+</span></span><span class="lv-num-precise">${i}</span></span></div>`:`<div class="inner-wrap"><span class="diff-name">${r}</span><span class="lv-num-wrap"><span class="lv-num-simple"><span class="num">${d}</span></span><span class="lv-num-precise">${i}</span></span></div>`}return`<div class="inner-wrap"><span class="diff-name">${r}</span><span class="lv-num-wrap"><span class="lv-num-simple"><span class="num">${t[e]}</span></span><span class="lv-num-precise">${i}</span></span></div>`}return s}}("chart_diff","chart_lev",0,"chart_lev_i_display"):null,width:"4rem",createdCell:flat_view?function(a,e,s,l,n){$(a).addClass(s.chart_diff)}:null,searchable:!1,visible:flat_view},{displayTitle:"ノート数",name:"chart_notes",data:flat_view?"chart_notes":null,className:"details notecount detail-hidden nowrap",width:"8em",searchable:!1},{displayTitle:"TAP",name:"chart_notes_tap",data:flat_view?"chart_notes_tap":null,className:"details notecount detail-hidden",width:"5em",searchable:!1,visible:!1},{displayTitle:"HOLD",name:"chart_notes_hold",data:flat_view?"chart_notes_hold":null,className:"details notecount detail-hidden",width:"5em",searchable:!1,visible:!1},{displayTitle:"SLIDE",name:"chart_notes_slide",data:flat_view?"chart_notes_slide":null,className:"details notecount detail-hidden",width:"5em",searchable:!1,visible:!1},{displayTitle:"AIR",name:"chart_notes_air",data:flat_view?"chart_notes_air":null,className:"details notecount detail-hidden",width:"5em",searchable:!1,visible:!1},{displayTitle:"FLICK",name:"chart_notes_flick",data:flat_view?"chart_notes_flick":null,className:"details notecount detail-hidden",width:"5em",searchable:!1,visible:!1},{displayTitle:"譜面作者",name:"chart_designer",data:flat_view?"chart_designer":null,width:"15em",className:"details detail-hidden designer",filterable:flat_view,searchable:flat_view},{displayTitle:"譜面作者",name:"chart_link",data:flat_view?"chart_link":null,render:flat_view?function(a,e,s){return"display"===e?_(s.chart_link):a}:null,width:"5em",className:"details detail-hidden chart-link"},{displayTitle:"追加日",name:"date",data:function(a,e,s,l){return h(a.date)},className:"date",render:function(a,e,s){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},reverseSortOrder:!0,width:"4em",filterable:!0},{displayTitle:"NEW",name:"new",data:"newflag",className:"detail-hidden",searchable:!1}],r=flat_view?[[19,"desc"],[18,"desc"],[28,"desc"]]:[[28,"desc"],[0,"asc"]];function i(a,e){return!!a.hasOwnProperty(e)&&""!==a[e]}function c(a,e){return function(s,l,n,t){return"sort"===l?""===s[e]?d(s[a]):d(s[e]):s[a]}}function d(a){return""!=a?(lev_processed=parseInt(a)<10?"0"+a:a,lev_processed):""}function o(a){return function(e,s){return d(e[a]).localeCompare(d(s[a]))}}function p(a,e){return function(s,l,n){if("display"===l){var t=n[a].match(/^([0-9]{1,2})(\+)?$/);if(t){var r=t[1];return"+"===t[2]?`<div class="inner-wrap"><span class="lv-num-simple"><span class="num">${r}</span><span class="plus">+</span></span><span class="lv-num-precise">${n[e]}</span></div>`:`<div class="inner-wrap"><span class="lv-num-simple"><span class="num">${r}</span></span><span class="lv-num-precise">${n[e]}</span></div>`}return`<div class="inner-wrap"><span class="lv-num-simple"><span class="num">${n[a]}</span></span><span class="lv-num-precise">${n[e]}</span></div>`}return s}}function v(a){const e={1:"1",3:"2",5:"3",7:"4",9:"5"};return e.hasOwnProperty(a)?e[a]:a}function _(a){return""!==a?`<a class="btn chartlink" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();" href="https://sdvx.in/chunithm/${a}.htm">\n                        <span class="img"></span><span>譜面確認</span>\n                    </a><span class="chart-provider">sdvx.in 提供</span>`:""}function u(a,e){if(e)switch(a){case"lev_bas":s="1 BASIC";break;case"lev_adv":s="2 ADVANCED";break;case"lev_exp":s="3 EXPERT";break;case"lev_mas":s="4 MASTER";break;case"lev_ult":s="5 ULTIMA";break;case"we_kanji":s="6 WORLD'S END"}else switch(a){case"lev_bas":var s="BASIC";break;case"lev_adv":var s="ADVANCED";break;case"lev_exp":var s="EXPERT";break;case"lev_mas":var s="MASTER";break;case"lev_ult":var s="ULTIMA";break;case"we_kanji":var s="WORLD'S END"}return s}function m(a,e){return e?a.map((a=>["lev_bas","lev_adv","lev_exp","lev_mas","lev_ult","we_kanji"].map((e=>function(a,e){if(a[e])return"we_kanji"===e?{...a,chart_diff:e,chart_lev:a[e],chart_lev_i:v(a.we_star),chart_lev_i_display:v(a.we_star),chart_notes:a.lev_we_notes,chart_notes_tap:a.lev_we_notes_tap,chart_notes_hold:a.lev_we_notes_hold,chart_notes_slide:a.lev_we_notes_slide,chart_notes_air:a.lev_we_notes_air,chart_notes_flick:a.lev_we_notes_flick,chart_designer:a.lev_we_designer,chart_link:a.lev_we_chart_link}:{...a,chart_diff:e,chart_lev:a[e],chart_lev_i:parseFloat(a[e+"_i"]||a[e].replace("+",".5")),chart_lev_i_display:a[e+"_i"]||`<span class="approx">${parseFloat(a[e].replace("+",".5")).toFixed(1)}</span>`,chart_notes:a[e+"_notes"],chart_notes_tap:a[e+"_notes_tap"],chart_notes_hold:a[e+"_notes_hold"],chart_notes_slide:a[e+"_notes_slide"],chart_notes_air:a[e+"_notes_air"],chart_notes_flick:a[e+"_notes_flick"],chart_designer:a[e+"_designer"],chart_link:a[e+"_chart_link"]};return null}(a,e))))).flat().filter((a=>!!a)):a}function h(a,e){var s=a.slice(0,4),l=a.slice(4,6),n=a.slice(6,8),t=`${s}-${l}-${n}`;if("JP"==e)var r=((new Date).getFullYear()==s?"":s+"/")+`${l}/${n}(${["日","月","火","水","木","金","土"][new Date(t).getDay()]})`;else r=t;return r}if($.getJSON("data/music-ex.json",(a=>{$("#table").DataTable({data:m(a,flat_view),buttons:[{extend:"colvis",className:"config-btn",columns:".toggle",text:"カラムON/OFF",collectionTitle:"表示するカラムを選択",collectionLayout:"fixed",fade:150}],columns:t,deferRender:!0,dom:'<"toolbar-group"<"toolbar filters"><"toolbar search"f>><"toolbar secondary"<"info"ilB>><"table-inner"rt><"paging"p>',language:{emptyTable:"テーブルにデータがありません",info:replaceUnitText(" _TOTAL_unit (_START_〜_END_ 表示中)"),infoEmpty:replaceUnitText(" 0 unit"),infoFiltered:replaceUnitText("（全 _MAX_ unit）"),infoPostFix:"",infoThousands:",",lengthMenu:"1ページ表示 _MENU_",loadingRecords:"読み込み中...",processing:"処理中...",search:"検索",searchPlaceholder:"曲名・アーティスト",zeroRecords:"一致するレコードがありません",paginate:{sFirst:"先頭",sLast:"最終",sNext:"NEXT",sPrevious:"PREV"},aria:{sSortAscending:": 列を昇順に並べ替えるにはアクティブにする",sSortDescending:": 列を降順に並べ替えるにはアクティブにする"}},lengthMenu:[[25,50,100,-1],[25,50,100,"All"]],order:r,responsive:{details:{type:"column",target:"tr",display:$.fn.dataTable.Responsive.display.modal({header:function(a){var e=a.data(),s=encodeURIComponent(e.title.replaceAll("&","＆").replaceAll(":","：").replaceAll("[","［").replaceAll("]","］").replaceAll("#","＃").replaceAll('"',"”")),l="https://wikiwiki.jp/chunithmwiki/"+s,n=e.wikiwiki_url?e.wikiwiki_url:l;return'<div class="modal-header" style="--img:url(jacket/'+e.image+');"><span class="header-img"></span><span class="header-img-overlay"></span><div class="img-wrap"><img src="jacket/'+e.image+'"/></div><div class="content-wrap"><span class="title">'+e.title+'</span><span class="artist">'+e.artist+'</span><div class="quicklinks"><a class="wiki" href="'+n+'" target="_blank" rel="noopener noreferer nofollow">Wiki</a><a class="youtube" href="https://youtube.com/results?search_query=CHUNITHM+譜面確認+'+s+'" target="_blank" rel="noopener noreferer nofollow"></a></div></div></div>'},footer:function(a){var e=a.data();return'<div class="modal-footer"><div class="report"><a class="report-btn" href="https://twitter.com/intent/tweet?text=@zvuc_%0A%E3%80%90%23CHUNITHM_DB%20%E6%83%85%E5%A0%B1%E6%8F%90%E4%BE%9B%E3%80%91%0A%E6%9B%B2%E5%90%8D%EF%BC%9A'+encodeURIComponent(e.title)+'%0A%E8%AD%9C%E9%9D%A2%EF%BC%9A" target="_blank" rel="noopener noreferer nofollow">💬 足りない情報・間違いを報告する （Twitter）</a></div></div>'}}),renderer:function(a,e,s){var l=a.row(e).data(),n=""!==l.lev_ult?"ultima":"",r=""!==l.we_kanji?"worldsend":"",c=$.map(s,(function(a,e){a.columnIndex;if(!a.className.includes("detail-hidden")&&!a.className.includes("lv "))return'<div class="row '+a.className+'" data-dt-row="'+a.rowIndex+'" data-dt-column="'+a.columnIndex+'"><span class="row-label">'+a.title+"</span> <span>"+a.data+"</span></div>"})).join(""),d=$.map(s,(function(a,e){var s=t[a.columnIndex];if(!a.className.includes("detail-hidden")&&a.className.includes("lv ")){var n=s.name,c=n.concat("_notes"),d=n.concat("_notes_tap"),o=n.concat("_notes_hold"),p=n.concat("_notes_slide"),v=n.concat("_notes_air"),u=n.concat("_notes_flick"),m=n.concat("_designer"),h=n.concat("_chart_link");return'<div class="row '+a.className+'" data-dt-row="'+a.rowIndex+'" data-dt-column="'+a.columnIndex+'"><span class="row-label"><span>'+s.displayTitle+'</span></span> <span class="content-col"><span class="main-info-wrap">'+(r?'<div class="inner-wrap"><span class="lv-num-simple">'+l.we_kanji+'</span><span class="lv-num-precise">'+function(a){const e={1:"☆",3:"☆☆",5:"☆☆☆",7:"☆☆☆☆",9:"☆☆☆☆☆"};return e.hasOwnProperty(a)?e[a]:a}(l.we_star)+"</span></div>":a.data)+'</span><span class="sub-info-wrap">'+(i(l,c)?'<span class="notes-detail-wrap"><span class="notes"><span class="label">Notes</span><span>'+l[c]+'</span></span><span class="notes-sub-detail-wrap">'+(i(l,d)?'<span class="notes_tap"><span class="label">tap</span><span>'+l[d]+"</span></span>":"")+(i(l,o)?'<span class="notes_hold"><span class="label">hold</span><span>'+l[o]+"</span></span>":"")+(i(l,p)?'<span class="notes_slide"><span class="label">slide</span><span>'+l[p]+"</span></span>":"")+(i(l,v)?'<span class="notes_air"><span class="label">air</span><span>'+l[v]+"</span></span>":"")+(i(l,u)?'<span class="notes_flick"><span class="label">flick</span><span>'+l[u]+"</span></span>":"")+"</span></span>":"")+(i(l,m)?'<span class="designer"><span class="label">Designer</span><span>'+l[m]+"</span></span>":"")+"</span></span>"+(i(l,h)?'<span class="chart-link">'+_(l[h])+"</span>":"")+"</div>"}})).join(""),o=$('<div class="table-wrapper"/>').append($('<div class="details-table chart-details '+r+n+'"/>').append('<div class="table-header"><span class="th-label">CHART</span></div>').append(d)).append($('<div class="details-table misc-details"/>').append('<div class="table-header"><span class="th-label">SONG METADATA</span></div>').append(c));return o||!1}}},rowGroup:{dataSrc:"date",startRender:flat_view||""!=n?null:function(a,e){return"<div>"+h(e,"JP")+" 追加</div>"}},scrollX:!0,initComplete:function(){var a=this.api().rows().data(),e=this.api();e.columns().every((function(){var s=e.order(),l=this,r=l.data(),i=t[l.index()];if("filterable"in i&&1==i.filterable){var c=$('<div class="select-wrap '+i.className+'"><span class="label">'+i.displayTitle+"</span></div>").appendTo($(".toolbar.filters")),d=$('<select id="'+i.name+'"><option value="" data-default>——</option></select>');if(d.appendTo(c),d.on("change",(function(){var a=$(this).val(),e=$.fn.dataTable.util.escapeRegex($(this).val());appendSelectboxStateClass($(this),a),28===l.index()||""===e&&28===s[0][0]?l.rowGroup().enable():l.rowGroup().disable(),updateQueryStringParameter(i.name,a),l.search(e?"^"+e+"$":"",!0,!1).draw()})),r=i.customDropdownSortSource?r.map((function(a,e){return e})).sort((function(e,s){var l=a[e],n=a[s];return"function"==typeof i.customDropdownSortSource?i.customDropdownSortSource(l,n):l[i.customDropdownSortSource].localeCompare(n[i.customDropdownSortSource])})).map((function(a){return r[a]})):r.sort(),i.reverseSortOrder&&r.reverse(),r.unique().each((function(a,e){""!=a&&d.append('<option value="'+a+'">'+a+"</option>")})),"URLSearchParams"in window){var o=n.get(i.name);if(null!==o){var p=unescapeSlashes(o);r.unique().each((function(a){d.val(p)})),appendSelectboxStateClass(d,p)}}}})),"URLSearchParams"in window&&(n.forEach((function(a,s){e.columns().every((function(){var a=t[this.index()],e=n.get(a.name),s=$.fn.dataTable.util.escapeRegex(decodeURIComponent(e));null!==e&&this.search(e?"^"+s+"$":"",!0,!1)}))})),e.draw()),e.on("order.dt",(function(){var a=e.order(),s=e.columns().search(),l=!1;for(let a=0;a<s.length;a+=1)if(a in s&&""!==s[a]){l=!0;break}return 27!==a[0][0]?void e.rowGroup().disable():27!==a[0][0]||l?void 0:void e.rowGroup().enable()})),$("#table").addClass("loading-done"),$("html").removeClass("table-loading")}})})),$("#table").on("column-visibility.dt",(function(){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()})),$("select#chart_lev").on("change",(function(){var a=$("#table").DataTable(),e=$(this),s=$(this).val(),l=$.fn.dataTable.util.escapeRegex($(this).val());"filter"==e.data("type")?(a.column("chart_lev:name").search(l?"^"+l+"$":"",!0,!1),updateQueryStringParameter("chart_lev",s),a.draw()):window.location.href="./lv?chart_lev="+encodeURIComponent(s)})),"URLSearchParams"in window){var f=n.get("chart_lev");if(null!==f){var w=unescapeSlashes(f);$("select#chart_lev").val(w)}}$("button.reset-search").on("click",(function(){$("#table").DataTable().order(r).search("").columns().search("").draw(),clearQueryStringParameter(),$(".toolbar.filters select").prop("selectedIndex",0).removeClass("changed"),console.log("search reset")}))}));

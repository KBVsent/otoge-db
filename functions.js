const toggleSwitch=document.getElementById("themeToggleCheckbox"),root=document.documentElement;window.matchMedia("(prefers-color-scheme: dark)").matches&&(toggleSwitch.checked=!1,root.setAttribute("data-theme","dark")),window.matchMedia("(prefers-color-scheme: light)").matches&&(toggleSwitch.checked=!0,root.setAttribute("data-theme","light")),whichTransitionEvent=()=>{let t,e=document.createElement("fakeelement"),n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in n)if(void 0!==e.style[t])return n[t]};let transitionEvent=whichTransitionEvent(),item=document.querySelector(".circle"),message=document.querySelector(".footer"),counter=1;function switchTheme(t){root.classList.toggle("transitioning"),t.target.checked?root.setAttribute("data-theme","light"):root.setAttribute("data-theme","dark"),root.addEventListener(transitionEvent,transitionEndCallback)}toggleSwitch.addEventListener("change",switchTheme,!1),transitionEndCallback=t=>{root.removeEventListener(transitionEvent,transitionEndCallback),root.classList.remove("transitioning")},$(document).ready((function(){$("html").removeClass("page-loading")}));
$(document).ready((function(){var a=[{displayTitle:"ID (system)",data:"id",className:"id",visible:!1},{displayTitle:"#",data:"image_url",className:"id",data:function(a){return a.image_url.split(".")[0]},render:function(a,e,t){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},width:"20px",searchable:!1},{displayTitle:"アルバムアート",data:"image_url",className:"jacket",render:function(a){return'<span class="img-wrap"><img src="jacket/'+a.split(".")[0]+'.jpg"/></span><span class="index">'+a.split(".")[0]+"</span>"},width:"50px",orderable:!1,searchable:!1},{displayTitle:"曲名",data:"title",className:"song-title",render:function(a,e,t){return"display"===e?'<div class="inner-wrap"><span class="title">'+a+'</span><span class="artist-display hidden">'+t.artist+"</span></div>":"filter"===e?a:t.title_sort},width:"80vw"},{displayTitle:"曲名 (読み)",data:"title_sort",className:"title-sort",visible:!1,searchable:!1},{displayTitle:"曲名・アーティスト",data:"title",className:"artist",render:function(a,e,t){return"display"===e?'<div class="inner-wrap"><span class="artist-display hidden">'+t.artist+"</span></div>":t.title_sort},searchable:!1},{displayTitle:"ジャンル",data:"category",className:"category",render:function(a,e,t){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},customDropdownSortSource:"category_id",filterable:!0},{displayTitle:"ジャンルID",data:"category_id",width:"90px",visible:!1},{displayTitle:"チャプターID",data:"chap_id",className:"chapter-id",visible:!1},{displayTitle:"チャプター",data:function(a,e,t,s){return"sort"===e?a.chap_id:(a.chap_chapter=a.chap_id.substr(3,2),"0"==a.chap_id.substr(0,1)?"1"==a.chap_id.substr(1,1)?(a.chap_book="1",a.chap_display=a.chap_book+"-"+a.chap_chapter+" "+a.chapter,a.chap_display):"2"==a.chap_id.substr(1,1)?(a.chap_book="2",a.chap_display=a.chap_book+"-"+a.chap_chapter+" "+a.chapter,a.chap_display):"3"==a.chap_id.substr(1,1)?"0308"==a.chap_id.substr(0,4)?(a.chap_book="3",a.chap_chapter=a.chap_id.substr(4,1),a.chap_display=a.chap_book+"-S"+a.chap_chapter+" "+a.chapter,a.chap_display):(a.chap_book="3",a.chap_display=a.chap_book+"-"+a.chap_chapter+" "+a.chapter,a.chap_display):(a.chap_display=a.chapter,a.chap_display):"80"==a.chap_id.substr(0,2)?(a.chap_book="SP2",a.chap_display=a.chap_book+"-"+a.chap_chapter+" "+a.chapter,a.chap_display):"99"==a.chap_id.substr(0,2)?(a.chap_book="SP",a.chap_display=a.chap_book+"-"+a.chap_chapter+" "+a.chapter,a.chap_display):(a.chap_display=a.chap_id+" "+a.chapter,a.chap_display))},className:"chapter",width:"15em",render:function(a,e,t){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},filterable:!0},{displayTitle:"属性",data:"enemy_type",className:"type",render:function(a,e,t){return"display"===e?'<div class="inner-wrap"><span class="type-icon '+a.toLowerCase()+'"><span>'+a+"</span></span></div>":a},width:"40px",filterable:!0},{displayTitle:"キャラID",data:"chara_id",visible:!1},{displayTitle:"相手キャラ",data:"character",className:"character",render:function(a,e,t){return"display"===e||"filter"===e?'<div class="inner-wrap">'+a+"</div>":t.chara_id},customDropdownSortSource:"chara_id",width:"10em",filterable:!0},{displayTitle:"相手レベル",data:"enemy_lv",className:"enemy-lv",render:function(a,e,t){return"display"===e?'<div class="inner-wrap">Lv.'+a+"</div>":a},customDropdownSortSource:s("enemy_lv"),width:"4em"},{displayTitle:"BASIC",data:e("lev_bas","lev_bas_i"),className:"lv lv-bsc",render:r("lev_bas","lev_bas_i"),customDropdownSortSource:s("lev_bas"),width:"3rem",filterable:!0},{displayTitle:"ADVANCED",data:e("lev_adv","lev_adv_i"),className:"lv lv-adv",render:r("lev_adv","lev_adv_i"),customDropdownSortSource:s("lev_adv"),width:"3rem",filterable:!0},{displayTitle:"EXPERT",data:e("lev_exc","lev_exc_i"),className:"lv lv-exp",render:r("lev_exc","lev_exc_i"),customDropdownSortSource:s("lev_exc"),width:"3rem",filterable:!0},{displayTitle:"MASTER",data:e("lev_mas","lev_mas_i"),className:"lv lv-mas",render:r("lev_mas","lev_mas_i"),customDropdownSortSource:s("lev_mas"),width:"3rem",filterable:!0},{displayTitle:"LUNATIC",data:e("lev_lnt","lev_lnt_i"),className:"lv lv-lnt",render:r("lev_lnt","lev_lnt_i"),customDropdownSortSource:s("lev_lnt"),width:"3rem",filterable:!0},{displayTitle:"NEW",data:"new",searchable:!1,visible:!1},{displayTitle:"追加日",data:"date",className:"date",filterable:!0,render:function(a,e,t){return"display"===e?'<div class="inner-wrap">'+a+"</div>":a},width:"4em"}];function e(a,e){return function(s,r,i,l){return"sort"===r?""===s[e]?t(s[a]):t(s[e]):s[a]}}function t(a){return""!=a?(lev_processed=parseInt(a)<10?"0"+a:a,lev_processed):""}function s(a){return function(e,s){return t(e[a]).localeCompare(t(s[a]))}}function r(a,e){return function(t,s,r){return"display"===s?'<div class="inner-wrap"><span class="lv-num-simple">'+r[a]+'</span><span class="lv-num-precise">'+r[e]+"</span></div>":t}}var i=$("#table").DataTable({ajax:{url:"data/music-ex.json",dataSrc:""},buttons:[{extend:"colvisRestore",text:"全表示"},{extend:"colvisGroup",text:"譜面レベルのみ",hide:[6,8,9,10,12,13,20],show:[14,15,16,17,18]},{extend:"colvisGroup",text:"EXPERT以上のみ",hide:[6,8,9,10,12,13,14,15,20],show:[16,17,18]},{extend:"colvisGroup",className:"asdf",text:"属性・Lv 表示",show:[10,13]},{extend:"colvis",className:"config-btn",columns:".toggle",text:"カスタム設定",collectionTitle:"表示・隠すカラムを選択",collectionLayout:"fixed",fade:150}],columns:a,deferRender:!0,dom:'<"column-toggle-bar"B><"toolbar-group"<"toolbar filters"><"toolbar search"f>><"toolbar secondary"<"info"il>><"table-inner"rt><"paging"p>',language:{sEmptyTable:"テーブルにデータがありません",sInfo:" _TOTAL_ 曲中 _START_〜_END_ まで表示中",sInfoEmpty:" 0 曲中 0〜0 まで表示中",sInfoFiltered:"（全 _MAX_ 曲）",sInfoPostFix:"",sInfoThousands:",",sLengthMenu:"1ページ表示 _MENU_",sLoadingRecords:"読み込み中...",sProcessing:"処理中...",sSearch:"キーワード検索",sZeroRecords:"一致するレコードがありません",oPaginate:{sFirst:"先頭",sLast:"最終",sNext:"次",sPrevious:"前"},oAria:{sSortAscending:": 列を昇順に並べ替えるにはアクティブにする",sSortDescending:": 列を降順に並べ替えるにはアクティブにする"}},lengthMenu:[[25,50,100,-1],[25,50,100,"All"]],order:[[20,"desc"],[9,"asc"],[0,"asc"]],responsive:{details:{type:"column",target:"tr",display:$.fn.dataTable.Responsive.display.modal({header:function(a){var e=a.data();return e.title+'<br><span class="artist">'+e.artist+"</span>"}}),renderer:$.fn.dataTable.Responsive.renderer.tableAll()}},rowGroup:{dataSrc:"date",startRender:function(a,e){return"<div>"+e+" 追加</div>"}},scrollX:!0,initComplete:function(){var e=this.api().rows().data();this.api().columns().every((function(){var t=i.order(),s=this,r=s.data(),l=a[s.index()];if("filterable"in l){var n=$('<div class="select-wrap"><span class="label">'+l.displayTitle+"</span></div>").appendTo($(".toolbar.filters")),o=$('<select><option value="" selected data-default>——</option></select>').appendTo(n).on("change",(function(){var a=$.fn.dataTable.util.escapeRegex($(this).val());20===s.index()||""===a&&20===t[0][0]?s.rowGroup().enable():s.rowGroup().disable(),s.search(a?"^"+a+"$":"",!0,!1).draw()}));r=l.customDropdownSortSource?r.map((function(a,e){return e})).sort((function(a,t){var s=e[a],r=e[t];return"function"==typeof l.customDropdownSortSource?l.customDropdownSortSource(s,r):s[l.customDropdownSortSource].localeCompare(r[l.customDropdownSortSource])})).map((function(a){return r[a]})):r.sort(),"date"==l.data&&r.reverse(),r.unique().each((function(a,e){""!=a&&o.append('<option value="'+a+'">'+a+"</option>")}))}})),i.on("order.dt",(function(){var a=i.order(),e=i.columns().search(),t=!1;for(let a=0;a<e.length;a+=1)if(a in e&&""!==e[a]){t=!0;break}return 20!==a[0][0]?void i.rowGroup().disable():20!==a[0][0]||t?void 0:void i.rowGroup().enable()}))}});$(".column-toggle-bar").prepend('<span class="label">ビューカスタマイズ</span>'),$("a.reset-search").on("click",(function(){i.order([[20,"desc"],[9,"asc"],[0,"asc"]]).search("").columns().search("").draw(),$(".toolbar.filters select").prop("selectedIndex",0),console.log("search reset")}))}));

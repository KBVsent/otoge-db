<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"> 
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <style>
        html, body {
            font-family: -apple-system, 'Segoe UI', sans-serif;
            font-feature-settings: "palt";
            padding: 0;
            margin: 0;
        }

        header {
            display: flex;
            align-items: center;
            padding: 10px 10px;
            border-bottom: 2px solid #aaa;
            margin-bottom: 10px;
        }
        h1 {
            margin: 0;
            font-size: 1.5em;
        }
        header .lastupdated {
            margin-left: auto;
        }

        #table_wrapper {
            padding: 10px 10px;
        }

        #table thead {
            position: sticky;
            top: 0;
            background: #fff;
        }

        thead .id select,
        thead .jacket select,
        thead .song-title select,
        thead .artist select {
            display: none;
        }

        thead select {
            font-size: 1em;
        }
        
        tbody td.id {
            font-variant-numeric: tabular-nums;
        }

        tbody td.song-title {
            font-weight: bold;
            font-size: 1.1em;
        }

        .jacket span {
            display: none;
        }
        .jacket img {
            max-width: 50px;
            height: auto;
        }
        tbody td.title-sort {
            font-size: 0.7em;
        }

        .lv-bsc {
            background: rgba(231, 249, 231, 0.5);
        }
        .lv-adv {
            background: rgba(255, 244, 201, 0.5);
        }
        .lv-exp {
            background: rgba(255, 224, 224, 0.5);
        }
        .lv-mas {
            background: rgba(248, 237, 255, 0.5);
        }
        .lv-lnt {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <header>
        <h1>オンゲキ収録曲DB</h1>
        <span class="lastupdated">Last updated 2019/06/01</span>
    </header>
    <table id="table" class="display" style="width:100%">
        <thead>
            <tr>
                <th><span>ID (system)</span></th>
                <th><span>ID</span></th>
                <th><span>アルバムアート</span></th>
                <th><span>曲名</span></th>
                <th><span>曲名 (読み)</span></th>
                <th><span>アーティスト</span></th>
                <th><span>カテゴリ</span></th>
                <th><span>category_id</span></th>
                <th><span>チャプターID</span></th>
                <th><span>チャプター</span></th>
                <th><span>chara_id</span></th>
                <th><span>相手キャラ</span></th>
                <th><span>追加日</span></th>
                <th><span>BSC</span></th>
                <th><span>ADV</span></th>
                <th><span>EXP</span></th>
                <th><span>MAS</span></th>
                <th><span>LNT</span></th>
                <th><span>new</span></th>
            </tr>
        </thead>
    </table>


    <script>
        $(document).ready(function() {
            var table = $('#table');
            
            table.DataTable( {
                "ajax": {
                    url: "music.json",
                    dataSrc: ""
                },
                "deferRender": true,
                "lengthMenu": [[-1, 10, 25, 50], ["All", 10, 25, 50]],
                "order": [[12, 'desc'],[0,'desc']], 
                "columns": [
                    { 
                        data: "id",
                        className: "id",
                        visible: false
                    },
                    { 
                        data: "image_url",
                        className: "id",
                        searchable: false,
                        render: function(data) {
                            return data.split(".")[0];
                        }
                    },
                    { 
                        data: "image_url",
                        className: "jacket",
                        orderable: false,
                        searchable: false,
                        render: function(data) {
                            return '<img src=\"img/' + data.split(".")[0] + '.jpg\"\/>';
                        }
                    },
                    { 
                        data: "title",
                        className: "song-title",
                        render: function ( data, type, row ) {
                            // If display or filter data is requested, return title
                            if ( type === 'display' || type === 'filter' ) {
                                return data;
                            }
                            // Else type detection or sorting data, return title_sort
                            else {
                                return row.title_sort;
                            }
                        }
                    },
                    {
                        data: "title_sort",
                        className: "title-sort",
                        visible: false
                    },
                    { 
                        data: "artist",
                        className: "artist",
                    },
                    { 
                        data: "category",
                        className: "category"
                    },
                    { 
                        data: "category_id",
                        visible: false
                    },
                    { 
                        data: "chap_id"
                    },
                    { 
                        data: "chapter",
                        className: "chapter"
                    },
                    { 
                        data: "chara_id",
                        visible: false
                    },
                    { 
                        data: "character"
                    },
                    { 
                        data: "date"
                    },
                    { 
                        data: "lev_bas",
                        className: "lv-bsc"
                    },
                    { 
                        data: "lev_adv",
                        className: "lv-adv"
                    },
                    { 
                        data: "lev_exc",
                        className: "lv-exp"
                    },
                    { 
                        data: "lev_mas",
                        className: "lv-mas"
                    },
                    { 
                        data: "lev_lnt",
                        className: "lv-lnt"
                    },
                    { 
                        data: "new",
                        searchable: false,
                        visible: false
                    }
                ],

                initComplete: function () {
                    this.api().columns().every( function () {
                        var column = this;
                        var select = $('<select onclick="event.stopPropagation()"><option value="">-------</option></select>')
                            .appendTo( $(column.header()) )
                            .on( 'change', function () {
                                var val = $.fn.dataTable.util.escapeRegex(
                                    $(this).val()
                                );
         
                                column
                                    .search( val ? '^'+val+'$' : '', true, false )
                                    .draw();
                            } );
                        column.data().unique().sort().each( function ( d, j ) {
                            select.append( '<option value="'+d+'">'+d+'</option>' );
                        } );
                    } );
                }
            });
        });
    </script>
</body>

</html>
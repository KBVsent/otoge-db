<!DOCTYPE html>
<html>
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141271073-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-141271073-1');
    </script>


    <meta charset="UTF-8"> 

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">

    <title>オンゲキ収録曲DB</title>

    <style>
        html {
            font-size: 14px;
            padding: 0;
            margin: 0;
        }
        @media screen and (min-width: 1440px) {
            html {
                font-size: 16px;
            }
        }
        body {
            font-family: -apple-system, 'Segoe UI', sans-serif;
            font-size: 1rem;
            font-feature-settings: "palt";
            padding: 0;
            margin: 0;
        }

        a {
            color: #ff1b71;
        }

        header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-bottom: 3px solid #ff1b71;
            background-color: #efefef;
            overflow: hidden;
        }
        h1 {
            margin: 0;
            font-size: 1.5em;
        }
        header .lastupdated {
            position: relative;
            display: inline-block;
            padding: 5px 30px 5px 30px;
            margin-left: auto;
            margin-right: -30px;
            color: #fff;
            text-transform: uppercase;
        }

        header .lastupdated:before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            background-color: #111;
            transform: skewX(-40deg);
        }

        header .lastupdated span {
            position: relative;
        }

        .toolbar {
            display: flex;
            padding: 0 10px;
            margin-bottom: 10px;
        }
        
        .dataTables_wrapper .dataTables_length {
        }

        .dataTables_wrapper .dataTables_info {
            padding: 0;
            margin-left: 20px;
        }

        .dataTables_wrapper .dataTables_filter {
            margin-left: auto;
        }

        #table_wrapper {
            padding: 10px 0;
        }

        .table-inner {
            width: 100%;
            overflow: hidden;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        #table {
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        #table thead {
            position: sticky;
            top: 0;
            background: #fff;
        }

        table.dataTable thead th,
        table.dataTable thead td {
            padding-left: 10px;
            padding-right: 20px;
        }

        thead span {
            display: block;
        }

        thead .id select,
        thead .jacket select,
        thead .song-title select,
        thead .artist select {
            display: none;
        }

        thead select {
            font-size: 1rem;
            text-overflow: ellipsis;
        }
        
        tbody td.id {
            font-variant-numeric: tabular-nums;
        }

        tbody td.song-title {
            font-weight: bold;
            font-size: 1.1em;
            width: 20%;
            min-width: 200px;
        }

        .artist {
            min-width: 150px;
        }
        
        .chapter-id {
            max-width: 80px;
            white-space: nowrap;
        }

        tbody td.chapter-id {
            font-size: 0.9em;
        }

        .chapter {
            max-width: 200px;
        }

        tbody td.chapter {
            font-size: 0.9em;
        }

        .chapter select {
            max-width: 150px;
        }

        .jacket {
            max-width: 60px;
        }

        .jacket span {
            display: none;
        }
        .jacket img {
            max-width: 50px;
            height: auto;
        }

        tbody td.title-sort {
            font-size: 0.7em;
        }

        .character {
            max-width: 200px;
        }

        .character select {
            max-width: 150px;
        }

        .lv {
            max-width: 50px;
        }

        .lv select {
            max-width: 4.5em;
        }

        tbody td.lv {
            font-size: 1.1em;
        }

        .lv-bsc {
            background: rgba(231, 249, 231, 0.5);
        }
        .lv-adv {
            background: rgba(255, 244, 201, 0.5);
        }
        .lv-exp {
            background: rgba(255, 224, 224, 0.5);
        }
        .lv-mas {
            background: rgba(248, 237, 255, 0.5);
        }
        .lv-lnt {
            background: rgba(255, 255, 255, 0.5);
        }

        .lv-bsc.sorting_1 {
            background: rgba(231, 249, 231, 1) !important;
        }
        .lv-adv.sorting_1 {
            background: rgba(255, 244, 201, 1) !important;
        }
        .lv-exp.sorting_1 {
            background: rgba(255, 224, 224, 1) !important;
        }
        .lv-mas.sorting_1 {
            background: rgba(248, 237, 255, 1) !important;
        }
        .lv-lnt.sorting_1 {
            background: rgba(255, 255, 255, 1) !important;
        }

        tbody td.date {
            text-align: center;
        }

        .paging {
            padding: 0 10px;
        }
        
        footer {
            padding: 25px 15px 15px 15px;
            font-size: 0.8em;
            color: #666;
        }

    </style>
</head>
<body>
    <header>
        <h1>オンゲキ収録曲DB</h1>
        <div class="lastupdated"><span>Last updated 2019/06/02</span></div>
    </header>
    <table id="table" class="display" style="width:100%">
        <thead>
            <tr>
                <th><span>ID (system)</span></th>
                <th><span>#</span></th>
                <th><span>アルバムアート</span></th>
                <th><span>曲名</span></th>
                <th><span>曲名 (読み)</span></th>
                <th><span>アーティスト</span></th>
                <th><span>カテゴリ</span></th>
                <th><span>category_id</span></th>
                <th><span>チャプターID</span></th>
                <th><span>チャプター</span></th>
                <th><span>chara_id</span></th>
                <th><span>相手キャラ</span></th>
                <th><span>BSC</span></th>
                <th><span>ADV</span></th>
                <th><span>EXP</span></th>
                <th><span>MAS</span></th>
                <th><span>LNT</span></th>
                <th><span>new</span></th>
                <th><span>追加日</span></th>
            </tr>
        </thead>
    </table>
    
    <footer>
        <p><b>DISCLAIMER: This website is not in any way afiiliated with or endorsed by SEGA. All copyrighted materials owned by their respective owners.</b></p>
        <p>Made by <a href="https://twitter.com/zvuc_" target="_blank" rel="noopener">@zvuc_</a> / Contributions & feedback on <a href="https://github.com/zvuc/ongeki-db" target="_blank" rel="noopener">GitHub</a></p>
    </footer>

    <script>
        $(document).ready(function() {
            var table = $('#table');
            var columns_params = [
                    { 
                        data: "id",
                        className: "id",
                        visible: false
                    },
                    { 
                        data: "image_url",
                        className: "id",
                        searchable: false,
                        render: function(data) {
                            return data.split(".")[0];
                        }
                    },
                    { 
                        data: "image_url",
                        className: "jacket",
                        orderable: false,
                        searchable: false,
                        render: function(data) {
                            return '<img src=\"img/' + data.split(".")[0] + '.jpg\"\/>';
                        }
                    },
                    { 
                        data: "title",
                        className: "song-title",
                        render: function ( data, type, row ) {
                            // If display or filter data is requested, return title
                            if ( type === 'display' || type === 'filter' ) {
                                return data;
                            }
                            // Else type detection or sorting data, return title_sort
                            else {
                                return row.title_sort;
                            }
                        }
                    },
                    {
                        data: "title_sort",
                        className: "title-sort",
                        visible: false
                    },
                    { 
                        data: "artist",
                        className: "artist",
                    },
                    { 
                        data: "category",
                        className: "category"
                    },
                    { 
                        data: "category_id",
                        visible: false
                    },
                    { 
                        data: "chap_id",
                        className: "chapter-id",
                        visible: false
                    },
                    {
                        // combine chap_id + chapter
                        data: function( row, type, set, meta ) {
                            if (type === 'sort') {
                                return row.chap_id;
                            } else {
                                row.chap_chapter = row.chap_id.substr(3,2);
                                if (row.chap_id.substr(0,1) == "0") {
                                    // 01xxx : chapter 1
                                    if (row.chap_id.substr(1,1) == "1") {
                                        row.chap_book = "1";
                                        row.chap_display = row.chap_book + '-' + row.chap_chapter + ' ' + row.chapter;
                                        return row.chap_display;
                                    } 
                                    // 02xxx : chapter 2
                                    else if (row.chap_id.substr(1,1) == "2") {
                                        row.chap_book = "2";
                                        row.chap_display = row.chap_book + '-' + row.chap_chapter + ' ' + row.chapter;
                                        return row.chap_display;
                                    }
                                    // 00xxx : default mylist
                                    else {
                                        row.chap_display = row.chapter;
                                        return row.chap_display;
                                    }
                                }
                                // 99xxx : Event chapters
                                else if (row.chap_id.substr(0,2) == "99") {
                                    row.chap_book = "SP";
                                    row.chap_display = row.chap_book + '-' + row.chap_chapter + ' ' + row.chapter;
                                    return row.chap_display;
                                }
                                // Others?
                                else {
                                    row.chap_display = row.chap_id + ' ' + row.chapter;
                                    return row.chap_display;
                                }
                            }
                        },
                        className: "chapter"
                    },
                    { 
                        data: "chara_id",
                        visible: false
                    },
                    { 
                        data: "character",
                        className: "character",
                        render: function ( data, type, row ) {
                            if ( type === 'display' || type === 'filter' ) {
                                return data;
                            }
                            // use chara_id for sort
                            else {
                                return row.chara_id;
                            }
                        },
                        customSort: function(row_a, row_b) {
                            return row_a.chara_id.localeCompare(row_b.chara_id);
                        }
                    },
                    { 
                        //  BASIC
                        data: function ( row, type, set, meta ) {
                            if ( type === 'display' || type === 'filter' ) {
                                return row.lev_bas;
                            }
                            else {
                                row.lev_bas_sort = addLeadingZero(row.lev_bas);
                                return row.lev_bas_sort;
                            }
                        },
                        className: "lv lv-bsc"
                    },
                    { 
                        //  ADVANCED
                        data: function ( row, type, set, meta ) {
                            if ( type === 'display' || type === 'filter' ) {
                                return row.lev_adv;
                            }
                            else {
                                row.lev_adv_sort = addLeadingZero(row.lev_adv);
                                return row.lev_adv_sort;
                            }
                        },
                        className: "lv lv-adv"
                    },
                    { 
                        //  EXPERT
                        data: function ( row, type, set, meta ) {
                            if ( type === 'display' || type === 'filter' ) {
                                return row.lev_exc;
                            }
                            else {
                                row.lev_exc_sort = addLeadingZero(row.lev_exc);
                                return row.lev_exc_sort;
                            }
                        },
                        className: "lv lv-exp"
                    },
                    { 
                        //  MASTER
                        data: function ( row, type, set, meta ) {
                            if ( type === 'display' || type === 'filter' ) {
                                return row.lev_mas;
                            }
                            else {
                                row.lev_mas_sort = addLeadingZero(row.lev_mas);
                                return row.lev_mas_sort;
                            }
                        },
                        className: "lv lv-mas"
                    },
                    { 
                        //  LUNATIC
                        data: function ( row, type, set, meta ) {
                            if ( type === 'display' || type === 'filter' ) {
                                return row.lev_lnt;
                            }
                            else {
                                row.lev_lnt_sort = addLeadingZero(row.lev_lnt);
                                return row.lev_lnt_sort;
                            }
                        },
                        className: "lv lv-lnt"
                    },
                    { 
                        data: "new",
                        searchable: false,
                        visible: false
                    },
                    { 
                        data: "date",
                        className: "date",
                    }
                ];
            
            table.DataTable( {
                "ajax": {
                    url: "music.json",
                    dataSrc: ""
                },
                "dom": '<"toolbar"lif><"table-inner"rt><"paging"p>',
                "deferRender": true,
                "lengthMenu": [[25, 50, 100, -1], [25, 50, 100, "All"]],
                "order": [[18, 'desc'],[0,'desc']], 
                // "columnDefs": [
                //     {
                //         "render": function ( data, type, row ) {
                //             return '('+ row[8]+') ' + data;
                //         },
                //         "targets": 9
                //     }
                // ],
                "columns": columns_params,

                // Generate Filter dropdown per columns
                initComplete: function () {
                    var rows = this.api().rows().data();
                    this.api().columns().every( function () {
                        var column = this;
                        var select = $('<select onclick="event.stopPropagation()"><option value="" selected>—</option></select>')
                            .appendTo( $(column.header()) )
                            .on( 'change', function () {
                                var val = $.fn.dataTable.util.escapeRegex(
                                    $(this).val()
                                );
         
                                column
                                    .search( val ? '^'+val+'$' : '', true, false )
                                    .draw();
                            } );
                        var column_data = column.data();
                        var column_param = columns_params[column.index()];

                        if (column_param.customSort) {
                            column_data = column_data.map(function(_, index) {
                                return rows[index];
                            }).sort(function(row_a, row_b) {
                                return column_param.customSort(row_a, row_b);
                            }).map(function(row) {
                                return row[column_param.data];
                            });
                        } else {
                            column_data = column_data.sort();
                        }
                        
                        column_data.unique().each( function ( d, j ) {
                            if (d != ''){
                                select.append( '<option value="'+d+'">'+d+'</option>' );
                            }
                        } );
                    } );
                }
            });
        });

        function addLeadingZero(s) {
            lev_processed = parseInt(s) < 10 ? ('0' + s) : s;
            return lev_processed;
        }
    </script>
</body>

</html>